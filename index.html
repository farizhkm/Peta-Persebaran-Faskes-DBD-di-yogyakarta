<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>Peta Analisis Prioritas Penanganan Kesehatan (Faskes) Berdasarkan Multikriteria di Kota Yogyakarta</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="data/Yogyakartakecamatan_1.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-7.853521793555537,110.33019517755113],[-7.764055136707789,110.42202035786588]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var title = new L.Control({'position':'topright'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>Peta Analisis Prioritas Penanganan Kesehatan (Faskes) Berdasarkan Multikriteria di Kota Yogyakarta</h2>';
        };
        title.addTo(map);
        var abstract = new L.Control({'position':'topright'});
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div',
            'leaflet-control abstract');
            this._div.id = 'abstract'
                this._div.setAttribute("onmouseenter", "abstract.show()");
                this._div.setAttribute("onmouseleave", "abstract.hide()");
                this.hide();
                return this._div;
            };
            abstract.hide = function () {
                this._div.classList.remove("abstractUncollapsed");
                this._div.classList.add("abstract");
                this._div.innerHTML = 'i'
            }
            abstract.show = function () {
                this._div.classList.remove("abstract");
                this._div.classList.add("abstractUncollapsed");
                this._div.innerHTML = 'Penelitian ini bertujuan untuk memetakan dan menganalisis klasifikasi serta distribusi fasilitas kesehatan di wilayah Kota Yogyakarta. Pemetaan ini penting untuk memahami ketersediaan layanan kesehatan, mendukung perencanaan kebijakan kesehatan publik, dan mengidentifikasi area yang membutuhkan peningkatan aksesibilitas fasilitas kesehatan.';
        };
        abstract.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OSMStandard_0');
        map.getPane('pane_OSMStandard_0').style.zIndex = 400;
        var layer_OSMStandard_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OSMStandard_0',
            opacity: 1.0,
            attribution: '<a href="https://www.openstreetmap.org/copyright">Â© OpenStreetMap contributors, CC-BY-SA</a>',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OSMStandard_0;
        map.addLayer(layer_OSMStandard_0);
        function pop_Yogyakartakecamatan_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Nama Kelurahan</th>\
                        <td>' + (feature.properties['NAMOBJ'] !== null ? autolinker.link(String(feature.properties['NAMOBJ']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nama Kecamatan</th>\
                        <td>' + (feature.properties['WADMKD'] !== null ? autolinker.link(String(feature.properties['WADMKD']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Luas Wilayah</th>\
                        <td>' + (feature.properties['LUAS'] !== null ? autolinker.link(String(feature.properties['LUAS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Fasilitas Kesehatan</th>\
                        <td>' + (feature.properties['klinik'] !== null ? autolinker.link(String(feature.properties['klinik']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Fasilitas Kesehatan</th>\
                        <td>' + (feature.properties['faskes'] !== null ? autolinker.link(String(feature.properties['faskes']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jumlah Penduduk</th>\
                        <td>' + (feature.properties['jmlh pnddk'] !== null ? autolinker.link(String(feature.properties['jmlh pnddk']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Penyakit DBD</th>\
                        <td>' + (feature.properties['dbd'] !== null ? autolinker.link(String(feature.properties['dbd']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Prioritas </th>\
                        <td>' + (feature.properties['Prioritas'] !== null ? autolinker.link(String(feature.properties['Prioritas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Yogyakartakecamatan_1_0(feature) {
            if (feature.properties['Prioritas'] >= 10.507000 && feature.properties['Prioritas'] <= 12.223000 ) {
                return {
                pane: 'pane_Yogyakartakecamatan_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(97,255,61,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Prioritas'] >= 12.223000 && feature.properties['Prioritas'] <= 14.404000 ) {
                return {
                pane: 'pane_Yogyakartakecamatan_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,170,170,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Prioritas'] >= 14.404000 && feature.properties['Prioritas'] <= 16.956000 ) {
                return {
                pane: 'pane_Yogyakartakecamatan_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,85,85,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Prioritas'] >= 16.956000 && feature.properties['Prioritas'] <= 19.925000 ) {
                return {
                pane: 'pane_Yogyakartakecamatan_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_Yogyakartakecamatan_1');
        map.getPane('pane_Yogyakartakecamatan_1').style.zIndex = 401;
        map.getPane('pane_Yogyakartakecamatan_1').style['mix-blend-mode'] = 'normal';
        var layer_Yogyakartakecamatan_1 = new L.geoJson(json_Yogyakartakecamatan_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Yogyakartakecamatan_1',
            layerName: 'layer_Yogyakartakecamatan_1',
            pane: 'pane_Yogyakartakecamatan_1',
            onEachFeature: pop_Yogyakartakecamatan_1,
            style: style_Yogyakartakecamatan_1_0,
        });
        bounds_group.addLayer(layer_Yogyakartakecamatan_1);
        map.addLayer(layer_Yogyakartakecamatan_1);
        var overlaysTree = [
            {label: 'Yogyakarta (kecamatan)<br /><table><tr><td style="text-align: center;"><img src="legend/Yogyakartakecamatan_1_1050712223PrioritasRendah0.png" /></td><td>10,507 - 12,223	Prioritas Rendah</td></tr><tr><td style="text-align: center;"><img src="legend/Yogyakartakecamatan_1_1222314404PrioritasSedang1.png" /></td><td>12,223 - 14,404	Prioritas Sedang</td></tr><tr><td style="text-align: center;"><img src="legend/Yogyakartakecamatan_1_1440416956PrioritasTinggi2.png" /></td><td>14,404 - 16,956	Prioritas Tinggi</td></tr><tr><td style="text-align: center;"><img src="legend/Yogyakartakecamatan_1_1695619925PrioritasSangatTinggi3.png" /></td><td>16,956 - 19,925	Prioritas Sangat Tinggi</td></tr></table>', layer: layer_Yogyakartakecamatan_1},
            {label: "OSM Standard", layer: layer_OSMStandard_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        </script>        
    </body>
</html>
